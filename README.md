# MingJing 明镜 🔍

> 基于大模型的智能中文敏感信息识别与脱敏系统

[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)
[![Python](https://img.shields.io/badge/python-3.11+-blue.svg)](https://www.python.org/)
[![TypeScript](https://img.shields.io/badge/typescript-5.0+-blue.svg)](https://www.typescriptlang.org/)
[![Docker](https://img.shields.io/badge/docker-ready-brightgreen.svg)](https://www.docker.com/)
[![spaCy](https://img.shields.io/badge/spaCy-NLP-09a3d5.svg)](https://spacy.io/)

---

## �️ 系统架构

### 整体架构

```
┌────────────────────────────────────────────────────────────────────────────┐
│                              用户界面 (React)                               │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐     │
│  │  识别    │  │ 自动脱敏  │  │ 历史记录  │  │ 规则管理  │  │   配置   │     │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘  └──────────┘     │
└───────────────────────────────────┬────────────────────────────────────────┘
                                    │ HTTP/REST API
                                    ▼
┌────────────────────────────────────────────────────────────────────────────┐
│                           FastAPI 后端服务                                  │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │                        敏感信息识别引擎                               │  │
│  │  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐              │  │
│  │  │  规则引擎   │ -> │  NLP 引擎   │ -> │  LLM 引擎   │              │  │
│  │  │  (Regex)   │    │  (spaCy)    │    │ (大模型验证) │              │  │
│  │  │   ~1ms     │    │   ~10ms     │    │  ~100-500ms │              │  │
│  │  └─────────────┘    └─────────────┘    └─────────────┘              │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                     │
│  │   脱敏处理   │  │   文件解析   │  │   规则管理   │                     │
│  └──────────────┘  └──────────────┘  └──────────────┘                     │
└───────────────────────────────────┬────────────────────────────────────────┘
                                    │
                    ┌───────────────┼───────────────┐
                    ▼               ▼               ▼
             ┌──────────┐    ┌──────────┐    ┌──────────┐
             │  SQLite  │    │ 本地模型  │    │ LLM API  │
             │ 历史记录  │    │HuggingFace│    │ OpenAI   │
             └──────────┘    └──────────┘    └──────────┘
```

### 识别引擎流水线

```
                              输入文本
                                 │
                                 ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         第一层：规则引擎                                  │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐           │
│  │ 手机号  │ │ 身份证  │ │ 银行卡  │ │ 邮箱    │ │ IP地址  │  ...      │
│  │ Regex  │ │ Regex  │ │ Regex  │ │ Regex  │ │ Regex  │           │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘           │
│  特点：高精度、高性能、无误报                                            │
└─────────────────────────────────┬───────────────────────────────────────┘
                                  │ 候选实体
                                  ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         第二层：NLP 引擎                                  │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    spaCy 中文 NER 模型                           │   │
│  │  识别：人名 (PERSON) | 地名 (LOC) | 组织 (ORG) | 时间 (DATE)     │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│  特点：语义理解、上下文感知                                              │
└─────────────────────────────────┬───────────────────────────────────────┘
                                  │ 合并结果
                                  ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                      第三层：LLM 验证引擎 (可选)                          │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                      大语言模型验证                               │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │   │
│  │  │  本地模型   │  │   API 模式   │  │  Mock 模式  │              │   │
│  │  │ Qwen/GLM   │  │ GPT-4/Claude│  │   测试用    │              │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘              │   │
│  │  功能：上下文验证 | 误报过滤 | 置信度校准 | 推理解释               │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│  特点：高准确率、可解释性、智能推理                                       │
└─────────────────────────────────┬───────────────────────────────────────┘
                                  │ 验证后结果
                                  ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                           后处理                                         │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                  │
│  │  置信度过滤  │  │  重叠去重    │  │  结果排序    │                  │
│  │  threshold   │  │  overlap     │  │  by score    │                  │
│  └──────────────┘  └──────────────┘  └──────────────┘                  │
└─────────────────────────────────┬───────────────────────────────────────┘
                                  │
                                  ▼
                            最终识别结果
                    [实体类型, 文本, 位置, 置信度, LLM验证]
```

### 部署架构

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           Docker Compose                                 │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │                    Nginx (Frontend Container)                      │  │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                │  │
│  │  │ 静态资源    │  │ Gzip 压缩   │  │ 反向代理    │                │  │
│  │  │ React App  │  │ 缓存控制    │  │ /api -> :8000│                │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘                │  │
│  │                         Port: 80                                   │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│                                  │                                       │
│                                  ▼                                       │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │                   FastAPI (Backend Container)                      │  │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                │  │
│  │  │ 识别引擎    │  │ 脱敏处理    │  │ 历史管理    │                │  │
│  │  │ Rule+NLP+LLM│  │ Anonymizer │  │ SQLite     │                │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘                │  │
│  │                        Port: 8000                                  │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│                                  │                                       │
│                    ┌─────────────┴─────────────┐                        │
│                    ▼                           ▼                        │
│             ┌──────────────┐           ┌──────────────┐                 │
│             │   Volume     │           │   Volume     │                 │
│             │   /data/db   │           │  /data/logs  │                 │
│             │   SQLite DB  │           │   App Logs   │                 │
│             └──────────────┘           └──────────────┘                 │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## � 核心亮点

### 🤖 大模型增强识别
- **LLM 二次验证**: 结合传统 NLP 和大语言模型，双重验证识别结果
- **上下文理解**: 利用 LLM 理解上下文，减少误报和漏报
- **智能推理**: 大模型可以识别复杂的敏感信息模式
- **多模型支持**: 支持本地模型（HuggingFace）和 API 模式（OpenAI 兼容）
- **可配置验证**: 灵活开启/关闭 LLM 验证，平衡准确率和性能

### 🔍 混合识别引擎
- **规则引擎**: 基于正则表达式的高性能规则匹配
- **NLP 引擎**: spaCy 中文模型，识别人名、地名、组织机构
- **LLM 引擎**: 大模型验证和增强识别
- **三层架构**: 规则 → NLP → LLM，层层递进，准确率更高

### 🛡️ 智能脱敏策略
- **部分保留脱敏**: 保留部分信息，保持数据可用性
  - 手机号: `138****5678`
  - 身份证: `110101****1234`
  - 银行卡: `6222 **** **** 1234`
- **自定义脱敏规则**: 支持自定义每种类型的脱敏方式
- **批量脱敏**: 支持文本和文件批量脱敏

### � 企业级功能
- **29+ 敏感信息类型**: 覆盖个人信息、网络信息、敏感凭证等
- **多格式支持**: TXT、CSV、JSON、DOCX、XLSX、ZIP
- **批量处理**: 多文件并发处理，进度实时显示
- **历史记录**: 完整的操作历史、搜索、筛选、导出
- **规则管理**: 自定义规则、测试、启用/禁用
- **性能优化**: 防抖搜索、分页显示、数据库索引

### 🚀 技术特性
- ⚡ **高性能**: 文件大小限制、搜索防抖、分页显示、数据库索引
- 🎨 **现代UI**: React 18 + TypeScript + TailwindCSS
- 🐳 **一键部署**: Docker Compose 容器化部署
- 📱 **响应式设计**: 支持桌面和移动端
- 🔒 **安全可靠**: 输入验证、文件限制、CORS 配置、XSS 防护

---

## 🚀 快速开始

### 一键部署（推荐）

```bash
# 1. 克隆项目
git clone https://github.com/your-username/mingjing.git
cd mingjing

# 2. 启动服务
./deploy.sh start

# 3. 访问系统
# 前端: http://localhost
# 后端: http://localhost:8000
# API 文档: http://localhost:8000/docs
```

### 手动部署

详见 [部署文档](DEPLOYMENT.md)

---

## 📸 界面预览

### 敏感信息识别
<img width="1692" height="844" alt="image" src="https://github.com/user-attachments/assets/3e7fab88-5d14-4946-b629-fc3446ce8301" />

<img width="1712" height="1144" alt="image" src="https://github.com/user-attachments/assets/044413d0-cd5e-424f-a0d0-514ffcb80bc5" />


### 自动脱敏
<img width="2496" height="1092" alt="image" src="https://github.com/user-attachments/assets/12d99b06-4da8-46a0-bdbe-7dc955bbfc03" />


### 历史记录

<img width="2784" height="1246" alt="image" src="https://github.com/user-attachments/assets/bf54e08e-9e6c-46a7-b9d4-88608064a64f" />

---

## 🎯 支持的敏感信息类型

### 个人信息
- 身份证号 (CN_ID_CARD)
- 手机号 (CN_PHONE)
- 邮箱 (CN_EMAIL)
- 银行卡号 (CN_BANK_CARD)
- 护照号 (CN_PASSPORT)
- 车牌号 (CN_VEHICLE_PLATE)

### 网络信息
- IP 地址 (CN_IP_ADDRESS)
- 内网 IP (INTERNAL_IP)
- MAC 地址 (MAC_ADDRESS)
- URL (URL)

### 敏感凭证
- API 密钥 (API_KEY)
- JWT Token (CN_JWT)
- GitHub Token (GITHUB_TOKEN)
- Slack Token (SLACK_TOKEN)
- AWS 密钥 (AWS_KEY)
- 云服务密钥 (CN_CLOUD_KEY)

### 其他
- 人名 (PERSON)
- 地址 (LOCATION)
- 组织机构 (ORGANIZATION)
- 邮政编码 (CN_POSTAL_CODE)
- ...更多

---

## 📖 使用指南

### 1. 文本识别

```bash
# 在"识别"页面输入或粘贴文本
# 点击"开始分析"
# 查看识别结果
```

### 2. 文件识别

```bash
# 切换到"文件"模式
# 上传文件（支持拖拽）
# 自动识别敏感信息
```

### 3. 自动脱敏

```bash
# 在"自动脱敏"页面输入文本
# 点击"开始脱敏"
# 复制脱敏后的文本
```

### 4. 配置 LLM 验证（可选）

#### 方式一：使用本地模型

```bash
# 1. 在"配置"页面选择"LLM 配置"
# 2. 选择"本地模型"模式
# 3. 输入模型路径（HuggingFace 模型名或本地路径）
#    例如: Qwen/Qwen-7B-Chat
# 4. 选择设备: auto/cpu/cuda
# 5. 点击"保存配置"
```

#### 方式二：使用 API 模式

```bash
# 1. 在"配置"页面选择"LLM 配置"
# 2. 选择"API 模式"
# 3. 输入 API 配置:
#    - API Key: sk-xxx
#    - API Base: https://api.openai.com/v1
#    - Model: gpt-4
# 4. 点击"保存配置"
```

#### 启用 LLM 验证

```bash
# 在"识别"页面:
# 1. 勾选"使用 LLM 验证"选项
# 2. 点击"开始分析"
# 3. 查看带有 LLM 验证的结果
#    - verified: true 表示已验证
#    - llm_reason: 显示 LLM 的推理原因
```

### 5. 历史记录

```bash
# 查看所有操作历史
# 支持搜索、筛选、导出
# 批量删除记录
```

---

## ⚙️ 配置说明

### 环境变量

```bash
# 后端配置
BACKEND_PORT=8000
LOG_LEVEL=INFO

# 前端配置
FRONTEND_PORT=80

# 文件上传限制
MAX_FILE_SIZE=52428800  # 50MB
```

### 自定义规则

在"规则管理"页面可以：
- 添加自定义识别规则
- 测试规则效果
- 启用/禁用规则
- 调整规则优先级

---

## 📊 性能优化

- ✅ 文件大小限制（50MB）
- ✅ 搜索防抖（300ms）
- ✅ 分页显示（20条/页）
- ✅ 数据库索引优化
- ✅ Gzip 压缩
- ✅ 静态资源缓存

---

## 🔒 安全特性

- ✅ 文件大小验证
- ✅ 输入内容验证
- ✅ CORS 配置
- ✅ XSS 防护
- ✅ 安全响应头
- ✅ 本地数据存储

---

## 📝 API 文档

启动服务后访问：
- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

### 主要接口

```bash
# 文本分析
POST /analyze
{
  "text": "张三的手机号是13812345678",
  "entities": ["CN_PHONE"],
  "score_threshold": 0.5
}

# 文件分析
POST /analyze/file
FormData: file, entities, score_threshold

# 文件脱敏
POST /anonymize/file
FormData: file, entities, score_threshold

# 历史记录
GET /history?limit=100
POST /history
DELETE /history/{id}
```

---

## 🤝 贡献指南

欢迎贡献代码！请遵循以下步骤：

1. Fork 项目
2. 创建特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 提交 Pull Request

---

## 📄 开源协议

本项目采用 MIT 协议 - 详见 [LICENSE](LICENSE) 文件

---

## 🙏 致谢

- [spaCy](https://spacy.io/) - NLP 框架
- [FastAPI](https://fastapi.tiangolo.com/) - Web 框架
- [React](https://react.dev/) - 前端框架
- [TailwindCSS](https://tailwindcss.com/) - CSS 框架

---
**如果觉得有用，请给个 ⭐ Star！**
