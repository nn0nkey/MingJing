# 中国敏感信息识别器评分策略

## 评分阈值

| 分数范围 | 处理方式 | 说明 |
|---------|---------|------|
| ≥ 0.5 | 直接确认 | 高置信度，无需二次验证 |
| < 0.5 | 大模型验证 | 需要结合上下文（前后30字）二次确认 |
| = 0.0 | 丢弃 | 明确无效，不返回结果 |

## 测试结果

| 场景 | 分数 | 状态 |
|-----|------|------|
| 身份证-校验通过 | 1.00 | ✅ 直接确认 |
| 手机-有效号段 | 1.00 | ✅ 直接确认 |
| 银行卡-Luhn通过 | 1.00 | ✅ 直接确认 |
| 邮箱-QQ | 1.00 | ✅ 直接确认 |
| 车牌-有效省份 | 1.00 | ✅ 直接确认 |
| 内网IP | 1.00 | ✅ 直接确认 |
| JWT | 1.00 | ✅ 直接确认 |
| 阿里云AK | 1.00 | ✅ 直接确认 |
| 身份证-校验失败 | 0.50 | ✅ 直接确认 |
| 银行卡-Luhn失败 | 0.50 | ✅ 直接确认 |
| 邮箱-未知域名 | 0.40 | ⚠️ 需LLM验证 |
| 公网IP/版本号 | 0.40 | ⚠️ 需LLM验证 |
| 邮编 | 0.40 | ⚠️ 需LLM验证 |

## validate_result 返回值语义

| 返回值 | 含义 | 分数影响 |
|-------|------|---------|
| `True` | 完全确认有效（如校验码验证通过） | 分数 = 1.0 |
| `False` | 完全确认无效 | 分数 = 0.0，结果被丢弃 |
| `None` | 不确定，需要上下文判断 | 保持基础分数 |

## 各识别器评分策略

### 1. CN_ID_CARD (身份证)

| 模式 | 基础分数 | validate_result | 最终分数 |
|-----|---------|-----------------|---------|
| 完整格式 + 有效省份 | 0.5 | 校验码正确 → True | 1.0 |
| 完整格式 + 有效省份 | 0.5 | 校验码错误 → None | 0.5 (需LLM验证) |
| 18位数字 + 日期格式 | 0.4 | 校验码正确 → True | 1.0 |
| 18位数字 + 日期格式 | 0.4 | 校验码错误 → None | 0.4 (需LLM验证) |
| 任意18位 | 0.25 | - | 0.25 (需LLM验证) |

**评分理由**: 身份证有严格的校验码算法，校验通过可以100%确认。

### 2. CN_PHONE (手机号)

| 模式 | 基础分数 | validate_result | 最终分数 |
|-----|---------|-----------------|---------|
| +86前缀 + 有效号段 | 0.7 | 有效运营商 → True | 1.0 |
| 有效运营商号段 | 0.55 | 有效运营商 → True | 1.0 |
| 1[3-9]开头11位 | 0.4 | None | 0.4 (需LLM验证) |
| 固话带区号 | 0.5 | 有效区号 → True | 1.0 |
| 400/800服务号 | 0.6 | True | 1.0 |

**评分理由**: 手机号有明确的号段规则，但无校验码，需要结合上下文。

### 3. CN_BANK_CARD (银行卡)

| 模式 | 基础分数 | validate_result | 最终分数 |
|-----|---------|-----------------|---------|
| 银联卡 (62开头) | 0.5 | Luhn校验通过 → True | 1.0 |
| 银联卡 (62开头) | 0.5 | Luhn校验失败 → None | 0.5 (需LLM验证) |
| Visa/MasterCard | 0.45 | Luhn校验通过 → True | 1.0 |
| 通用16-19位 | 0.3 | Luhn校验通过 → True | 1.0 |
| 通用16-19位 | 0.3 | Luhn校验失败 → None | 0.3 (需LLM验证) |

**评分理由**: 银行卡有Luhn校验算法，但很多场景下校验码可能被脱敏。

### 4. CN_PASSPORT (护照)

| 模式 | 基础分数 | validate_result | 最终分数 |
|-----|---------|-----------------|---------|
| E/D/S/P + 8位 | 0.6 | 有效前缀 → True | 1.0 |
| 港澳通行证 C/W | 0.6 | True | 1.0 |
| 旧版G + 8位 | 0.5 | True | 1.0 |
| 通用格式 | 0.35 | None | 0.35 (需LLM验证) |

**评分理由**: 护照无校验码，但前缀规则明确。

### 5. CN_DRIVER_LICENSE (驾驶证)

| 模式 | 基础分数 | validate_result | 最终分数 |
|-----|---------|-----------------|---------|
| 18位 (同身份证) | 0.5 | 校验码正确 → True | 1.0 |
| 15位旧版 | 0.4 | None | 0.4 (需LLM验证) |
| 档案编号12位 | 0.35 | None | 0.35 (需LLM验证) |

**评分理由**: 驾驶证号与身份证相同，可复用校验逻辑。

### 6. CN_SOCIAL_CREDIT_CODE (统一社会信用代码)

| 模式 | 基础分数 | validate_result | 最终分数 |
|-----|---------|-----------------|---------|
| 完整18位 | 0.5 | 校验码正确 → True | 1.0 |
| 完整18位 | 0.5 | 校验码错误 → None | 0.5 (需LLM验证) |

**评分理由**: 有GB 32100-2015校验码算法。

### 7. CN_VEHICLE_PLATE (车牌号)

| 模式 | 基础分数 | validate_result | 最终分数 |
|-----|---------|-----------------|---------|
| 省份简称 + 字母 + 5位 | 0.7 | 有效省份 → True | 1.0 |
| 新能源8位 | 0.7 | True | 1.0 |
| 军警车牌 | 0.65 | True | 1.0 |
| 通用格式 | 0.4 | None | 0.4 (需LLM验证) |

**评分理由**: 车牌格式非常明确，省份简称可验证。

### 8. CN_POSTAL_CODE (邮政编码)

| 模式 | 基础分数 | validate_result | 最终分数 |
|-----|---------|-----------------|---------|
| 有效省份前缀 | 0.45 | 有效省份 → None | 0.45 (需LLM验证) |
| 6位数字 | 0.3 | None | 0.3 (需LLM验证) |

**评分理由**: 6位数字太常见，容易误报，必须结合上下文。

### 9. CN_EMAIL (邮箱)

| 模式 | 基础分数 | validate_result | 最终分数 |
|-----|---------|-----------------|---------|
| QQ邮箱 | 0.7 | True | 1.0 |
| 163/126邮箱 | 0.65 | True | 1.0 |
| 标准邮箱格式 | 0.5 | 有效域名 → True | 1.0 |
| 通用格式 | 0.4 | None | 0.4 (需LLM验证) |

**评分理由**: 邮箱格式明确，中国常用邮箱服务商可验证。

### 10. CN_IP_ADDRESS (IP地址)

| 模式 | 基础分数 | validate_result | 最终分数 |
|-----|---------|-----------------|---------|
| 内网IP (10/172/192) | 0.6 | True | 1.0 |
| 回环地址 127.0.0.1 | 0.7 | True | 1.0 |
| 通用IPv4 | 0.35 | None | 0.35 (需LLM验证) |
| IPv6 | 0.4 | None | 0.4 (需LLM验证) |

**评分理由**: 内网IP敏感性高，通用IP容易误报版本号等。

### 11. CN_JWT (JWT令牌)

| 模式 | 基础分数 | validate_result | 最终分数 |
|-----|---------|-----------------|---------|
| eyJ开头标准JWT | 0.8 | 可解码 → True | 1.0 |
| 类JWT格式 | 0.5 | None | 0.5 (需LLM验证) |

**评分理由**: JWT有明确的eyJ前缀（base64编码的{），可验证。

### 12. CN_CLOUD_KEY (云服务密钥)

| 模式 | 基础分数 | validate_result | 最终分数 |
|-----|---------|-----------------|---------|
| LTAI (阿里云) | 0.85 | True | 1.0 |
| AKID (腾讯云) | 0.85 | True | 1.0 |
| AKIA (AWS) | 0.85 | True | 1.0 |
| 通用AccessKey | 0.4 | None | 0.4 (需LLM验证) |

**评分理由**: 云厂商密钥有明确前缀，高度可信。

### 13. CN_SENSITIVE_FIELD (敏感字段)

| 模式 | 基础分数 | validate_result | 最终分数 |
|-----|---------|-----------------|---------|
| password字段 | 0.7 | True | 1.0 |
| 私钥头 | 0.9 | True | 1.0 |
| token/secret字段 | 0.6 | True | 1.0 |
| 通用敏感字段 | 0.45 | None | 0.45 (需LLM验证) |

**评分理由**: 敏感字段名明确，但值可能是占位符。

## 上下文增强

当检测到上下文词时，分数可以额外增加（由AnalyzerEngine处理）：
- 强上下文词（如"身份证号"）: +0.35
- 弱上下文词（如"号码"）: +0.15

## 大模型验证输入格式

当分数 < 0.5 时，传递给大模型的格式：

```json
{
  "entity_type": "CN_ID_CARD",
  "matched_text": "110101199003074518",
  "score": 0.4,
  "context": "用户的证件号码是110101199003074518请妥善保管",
  "context_start": 0,
  "context_end": 28
}
```

上下文截取规则：前后各30个字符，遇到边界则截断。
